<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notebooks</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", Arial, sans-serif; 
            margin: 0; 
            line-height: 1.6;
            display: flex;
            justify-content: center;
            background-color: #f8f8f8;
            padding: 20px;
        }
        h1, h2 { 
            color: #333;
            font-weight: 400;
        }
        .container { 
            max-width: 800px;
            width: 100%;
            background-color: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        header h1 {
            margin-bottom: 5px;
        }
        .back-link {
            margin-bottom: 20px;
        }
        .back-link a {
            color: #0077cc;
            text-decoration: none;
        }
        .back-link a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="back-link">
            <a href="index.html">‚Üê Main page</a>
        </div>
        <header>
            <h1>Notebooks</h1>
        </header>
        
        <section id="notebook-entries">
            <!-- Entries will be loaded here -->
        </section>
    </div>
    
    <script>
        async function loadNotebooks() {
            const entriesContainer = document.getElementById('notebook-entries');
            
            try {
                // Fetch list of files in notebooks folder from GitHub API
                const response = await fetch('https://api.github.com/repos/jswachter/jswachter.github.io/contents/notebooks');
                const files = await response.json();
                
                // Filter for .md files and sort by date (newest first)
                const mdFiles = files.filter(file => file.name.endsWith('.md'))
                                    .sort((a, b) => b.name.localeCompare(a.name));
                
                for (const file of mdFiles) {
                    // Fetch the content of each markdown file
                    const contentResponse = await fetch(file.download_url);
                    const content = await contentResponse.text();
                    
                    // Parse frontmatter and content
                    const lines = content.split('\n');
                    let title = file.name.replace('.md', '').replace(/-/g, ' ');
                    let date = '';
                    let preview = '';
                    
                    // Simple frontmatter parsing
                    if (lines[0] === '---') {
                        let i = 1;
                        while (i < lines.length && lines[i] !== '---') {
                            if (lines[i].startsWith('title:')) {
                                title = lines[i].substring(6).trim();
                            } else if (lines[i].startsWith('date:')) {
                                date = new Date(lines[i].substring(5).trim()).toLocaleDateString('en-US', { 
                                    year: 'numeric', 
                                    month: 'long', 
                                    day: 'numeric' 
                                });
                            }
                            i++;
                        }
                        // Get preview from content after frontmatter
                        const contentStart = lines.slice(i + 1).join('\n');
                        preview = contentStart.replace(/#.*\n/g, '').substring(0, 150).trim() + '...';
                    }
                    
                    // Create entry element
                    const entryDiv = document.createElement('div');
                    entryDiv.className = 'entry';
                    entryDiv.style.marginBottom = '30px';
                    entryDiv.innerHTML = `
                        <h3><a href="notebook-viewer.html?entry=notebooks/${file.name}" style="color: #333; text-decoration: none;">${title}</a></h3>
                        <p class="date" style="color: #888; font-size: 14px; margin: 5px 0;">${date}</p>
                        <p style="color: #555; margin: 10px 0;">${preview}</p>
                    `;
                    entriesContainer.appendChild(entryDiv);
                }
                
                if (mdFiles.length === 0) {
                    entriesContainer.innerHTML = '<p style="color: #888;">No notebook entries yet.</p>';
                }
                
            } catch (error) {
                console.error('Error loading notebooks:', error);
                entriesContainer.innerHTML = '<p style="color: #888;">Unable to load notebook entries.</p>';
            }
        }
        
        // Load notebooks when page loads
        loadNotebooks();
    </script>
</body>
</html>